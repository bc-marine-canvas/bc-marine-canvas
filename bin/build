#!/bin/bash

set -e

# Generate theme assets. The `yarn` command must be run from the theme
# directory, so change diretory before envoking, and change back afterwards.
theme_path="$2/app/content/themes/bc_marine_canvas"
pushd "$theme_path" >/dev/null 2>&1 || exit
yarn build:production
popd >/dev/null 2>&1 || exit

# Install packages with `composer`. This command will not install development
# dependencies.
composer install \
  --no-interaction \
  --no-scripts \
  --prefer-source \
  --no-dev

docker build -t "jbboynton/$1:latest" .

# Re-install development dependencies.
composer install --no-interaction --no-scripts
